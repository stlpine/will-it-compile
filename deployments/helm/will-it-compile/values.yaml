# Default values for will-it-compile.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Number of replicas for the API server
replicaCount: 1

# Container image configuration
image:
  repository: stlpine/will-it-compile-api
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

# Image pull secrets for private registries
imagePullSecrets: []

# Override the chart name
nameOverride: ""

# Override the full name
fullnameOverride: ""

# Compiler images matching configs/environments.yaml
# These images are pre-pulled during deployment
compilerImages:
  # C/C++ - Official GCC images (Debian-based, no alpine)
  # Supports C (GCC 9, 11, 13) and C++ (GCC 9, 10, 11, 12, 13)
  gcc:
    repository: gcc
    tags: ["9", "10", "11", "12", "13"]
    pullPolicy: IfNotPresent

  # Go - Official Golang images (Alpine-based)
  # Supports versions 1.20, 1.21, 1.22, 1.23
  go:
    repository: golang
    tags: ["1.20-alpine", "1.21-alpine", "1.22-alpine", "1.23-alpine"]
    pullPolicy: IfNotPresent

  # Rust - Official Rust images (Alpine-based)
  # Supports versions 1.70, 1.75, 1.80
  rust:
    repository: rust
    tags: ["1.70-alpine", "1.75-alpine", "1.80-alpine"]
    pullPolicy: IfNotPresent

# Service account configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 8080

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations:
    # Enable regex for precise path matching - ensures /api takes priority over /
    nginx.ingress.kubernetes.io/use-regex: "true"
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: chart-example.local
      paths:
        # API routes - regex ensures higher priority over catch-all
        - path: /api(/|$)(.*)
          pathType: ImplementationSpecific
          backend: api
        # Web frontend - catch all other routes
        - path: /
          pathType: Prefix
          backend: web
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

# Resource limits and requests
resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Horizontal Pod Autoscaler
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Network Policy
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  ingress: []
  egress: []

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# Environment variables for the API server
env:
  - name: PORT
    value: "8080"
  - name: NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace

# Redis Configuration
redis:
  # Enable Redis for job storage (set to false to use in-memory storage)
  enabled: false

  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent

  # Authentication
  auth:
    enabled: false
    password: ""  # Leave empty to auto-generate

  # Redis Configuration
  database: 0
  poolSize: 20
  jobTTL: 24  # Hours
  maxMemory: "256mb"
  maxMemoryPolicy: "allkeys-lru"

  # Resources
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Worker Pool Configuration
workerPool:
  enabled: false
  maxWorkers: 5
  queueSize: 100

# Web Frontend Configuration
web:
  # Enable web frontend
  enabled: false

  # Number of replicas
  replicaCount: 1

  # Container image
  image:
    repository: stlpine/will-it-compile-web
    pullPolicy: IfNotPresent
    tag: ""

  # Service configuration
  service:
    type: ClusterIP
    port: 80

  # Pod annotations
  podAnnotations: {}

  # Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 101  # nginx user
    fsGroup: 101

  # Container security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  # Resources
  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

  # Autoscaling
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

  # Node selector
  nodeSelector: {}

  # Tolerations
  tolerations: []

  # Affinity
  affinity: {}
