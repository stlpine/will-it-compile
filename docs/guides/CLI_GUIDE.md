# CLI Guide

The `will-it-compile` CLI tool provides a command-line interface for compiling code in isolated, secure Docker containers.

## Installation

### From Source

```bash
# Clone the repository
git clone https://github.com/stlpine/will-it-compile.git
cd will-it-compile

# Build the CLI
make build-cli

# Install to $GOPATH/bin (optional)
make install

# Or copy to system path
sudo cp bin/will-it-compile /usr/local/bin/
```

### Prerequisites

- Go 1.25+
- Docker installed and running
- Compiler images built: `make docker-build`

## Quick Start

```bash
# Compile a C++ file
will-it-compile compile mycode.cpp

# Compile with specific standard
will-it-compile compile mycode.cpp --std=c++20

# List supported environments
will-it-compile environments

# Show version
will-it-compile version
```

## Commands

### `compile`

Compile a source code file in an isolated Docker container.

#### Usage

```bash
will-it-compile compile <file> [flags]
```

#### Examples

```bash
# Basic compilation
will-it-compile compile hello.cpp

# With C++ standard
will-it-compile compile hello.cpp --std=c++20

# With specific compiler
will-it-compile compile hello.cpp --compiler=gcc-13

# Verbose output
will-it-compile compile hello.cpp --verbose

# Quiet mode (errors only)
will-it-compile compile hello.cpp --quiet

# Custom timeout
will-it-compile compile hello.cpp --timeout=60

# Hide stdout/stderr
will-it-compile compile hello.cpp --stdout=false --stderr=false
```

#### Flags

| Flag | Short | Default | Description |
|------|-------|---------|-------------|
| `--std` | | | Language standard (e.g., c++20, c++17, c++14, c++11) |
| `--compiler` | | | Compiler to use (e.g., gcc-13) |
| `--timeout` | | `30` | Compilation timeout in seconds |
| `--stdout` | | `true` | Show compilation stdout |
| `--stderr` | | `true` | Show compilation stderr |
| `--verbose` | `-v` | `false` | Verbose output |
| `--quiet` | `-q` | `false` | Quiet mode (errors only) |

#### Supported File Extensions

- `.cpp`, `.cc`, `.cxx`, `.c++` → C++
- `.c` → C

The language is automatically detected from the file extension.

#### Exit Codes

- `0` - Compilation successful
- `1` - Compilation failed or error occurred

### `environments`

List supported compilation environments.

#### Usage

```bash
will-it-compile environments [flags]
will-it-compile env           # short alias
will-it-compile envs          # alternative alias
```

#### Examples

```bash
# Table format (default)
will-it-compile environments

# List format
will-it-compile environments --output=list

# JSON format
will-it-compile environments --output=json
```

#### Flags

| Flag | Short | Default | Description |
|------|-------|---------|-------------|
| `--output` | `-o` | `table` | Output format: `table`, `list`, or `json` |

#### Output Formats

**Table Format:**
```
Language: cpp
  Compilers:  gcc-13
  Standards:  c++11, c++14, c++17, c++20, c++23
  OSes:       linux
  Arches:     x86_64
```

**List Format:**
```
cpp (gcc-13, c++11)
cpp (gcc-13, c++14)
cpp (gcc-13, c++17)
...
```

**JSON Format:**
```json
[
  {
    "language": "cpp",
    "compilers": ["gcc-13"],
    "standards": ["c++11", "c++14", "c++17", "c++20", "c++23"],
    "oses": ["linux"],
    "arches": ["x86_64"]
  }
]
```

### `version`

Show version information.

#### Usage

```bash
will-it-compile version [flags]
```

#### Examples

```bash
# Full version information
will-it-compile version

# Short version (version number only)
will-it-compile version --short
```

#### Flags

| Flag | Short | Default | Description |
|------|-------|---------|-------------|
| `--short` | `-s` | `false` | Print just the version number |

#### Output

**Full version:**
```
will-it-compile version v1.0.0
  Git commit:    a1b2c3d
  Built:         2025-11-10_10:33:31
  Go version:    go1.25.4
  OS/Arch:       darwin/arm64
```

**Short version:**
```
v1.0.0
```

### `completion`

Generate shell completion scripts (auto-generated by Cobra).

#### Usage

```bash
# Bash
will-it-compile completion bash > /etc/bash_completion.d/will-it-compile

# Zsh
will-it-compile completion zsh > "${fpath[1]}/_will-it-compile"

# Fish
will-it-compile completion fish > ~/.config/fish/completions/will-it-compile.fish

# PowerShell
will-it-compile completion powershell > will-it-compile.ps1
```

## Global Flags

These flags work with all commands:

| Flag | Short | Description |
|------|-------|-------------|
| `--verbose` | `-v` | Enable verbose output |
| `--quiet` | `-q` | Quiet mode (errors only) |
| `--help` | `-h` | Show help for command |

## Examples

### Compile a Simple C++ Program

```bash
# Create a test file
cat > hello.cpp << 'EOF'
#include <iostream>

int main() {
    std::cout << "Hello, World!" << std::endl;
    return 0;
}
EOF

# Compile it
will-it-compile compile hello.cpp
```

**Output:**
```
Compiling hello.cpp...
✓ Compilation successful (exit code: 0, duration: 1.234s)
```

### Compile with Errors

```bash
# Create a file with errors
cat > error.cpp << 'EOF'
int main() {
    return 0  // missing semicolon
}
EOF

# Try to compile
will-it-compile compile error.cpp
```

**Output:**
```
Compiling error.cpp...
✗ Compilation failed (exit code: 1, duration: 0.567s)

--- Stderr ---
error.cpp:2:14: error: expected ';' after return statement
    return 0  // missing semicolon
            ^
            ;
```

### Using Different Standards

```bash
# C++11
will-it-compile compile code.cpp --std=c++11

# C++17
will-it-compile compile code.cpp --std=c++17

# C++20 (default)
will-it-compile compile code.cpp --std=c++20

# C++23
will-it-compile compile code.cpp --std=c++23
```

### Scripting Examples

#### Check if Code Compiles (Exit Code)

```bash
#!/bin/bash

if will-it-compile compile mycode.cpp --quiet; then
    echo "Code compiles successfully!"
else
    echo "Code has compilation errors!"
    exit 1
fi
```

#### Batch Compilation

```bash
#!/bin/bash

for file in *.cpp; do
    echo "Checking $file..."
    if will-it-compile compile "$file" --quiet; then
        echo "  ✓ OK"
    else
        echo "  ✗ FAILED"
    fi
done
```

#### CI/CD Integration

```yaml
# .github/workflows/compile-check.yml
name: Compile Check

on: [push, pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Install will-it-compile
        run: |
          curl -L https://github.com/.../will-it-compile-linux-amd64 -o will-it-compile
          chmod +x will-it-compile
          sudo mv will-it-compile /usr/local/bin/

      - name: Check all C++ files
        run: |
          find src -name "*.cpp" -exec will-it-compile compile {} \;
```

## Environment Variables

The CLI respects these environment variables:

| Variable | Description | Default |
|----------|-------------|---------|
| `DOCKER_HOST` | Docker daemon socket | `unix:///var/run/docker.sock` |
| `DOCKER_API_VERSION` | Docker API version | Auto-detected |

## Configuration

Currently, the CLI uses sensible defaults and doesn't require a configuration file. All options can be specified via command-line flags.

Future versions may support a configuration file at:
- `~/.will-it-compile.yaml`
- `./.will-it-compile.yaml`

## Troubleshooting

### "No such image" Error

```
Error: compilation error: No such image: will-it-compile/cpp-gcc:13-alpine
```

**Solution:** Build the Docker images first:
```bash
make docker-build
```

### "Cannot connect to Docker daemon" Error

```
Error: failed to create Docker runtime: Cannot connect to the Docker daemon
```

**Solutions:**
1. Start Docker Desktop (macOS/Windows)
2. Start Docker daemon (Linux): `sudo systemctl start docker`
3. Check Docker socket permissions: `ls -l /var/run/docker.sock`

### "File not found" Error

```
Error: file not found: mycode.cpp
```

**Solutions:**
1. Check the file path is correct
2. Use absolute path: `will-it-compile compile /path/to/mycode.cpp`
3. Check file exists: `ls -la mycode.cpp`

### Timeout Errors

```
Error: compilation timeout
```

**Solutions:**
1. Increase timeout: `will-it-compile compile code.cpp --timeout=60`
2. Check for infinite loops in code
3. Optimize code complexity

## Performance Tips

1. **Pre-pull Images**: Docker images are cached after first use
2. **Use Quiet Mode**: For scripting, use `--quiet` to reduce output
3. **Batch Operations**: Group compilations to reuse containers
4. **Increase Timeout**: For complex code, use `--timeout=60` or higher

## Differences from API Server

| Feature | CLI | API Server |
|---------|-----|------------|
| **Runtime** | Always Docker | Docker (local) or Kubernetes (production) |
| **Authentication** | None | Rate limiting by IP |
| **Concurrency** | Sequential | Concurrent with goroutines |
| **Job Storage** | N/A | In-memory (MVP) |
| **Output** | Terminal | JSON over HTTP |
| **Use Case** | Local development, scripting | Production service |

## Future Features

Planned for future releases:

- [ ] Configuration file support (`~/.will-it-compile.yaml`)
- [ ] Watch mode (`--watch` to recompile on file changes)
- [ ] Multiple file compilation
- [ ] Output binary extraction
- [ ] TUI (Terminal User Interface) mode
- [ ] Plugin system for custom compilers
- [ ] Compilation caching
- [ ] Progress bars for long compilations

## Getting Help

```bash
# General help
will-it-compile --help

# Command-specific help
will-it-compile compile --help
will-it-compile environments --help
will-it-compile version --help

# Show version
will-it-compile version
```

## Contributing

See the main [README.md](README.md) for contribution guidelines.

## License

See [LICENSE](LICENSE) file.
